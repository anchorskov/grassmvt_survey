===============================================================================
PRODUCTION DIAGNOSTICS CHECK
===============================================================================
Timestamp: 2026-01-30 19:51:46 UTC
Hostname: Anchor
Repo Root: /home/anchor/projects/grassmvt_survey

Git Status:
  Branch: main
  Latest commit: d8e9c9b

===============================================================================
A) WORKER IDENTITY
===============================================================================

Command: wrangler --version
4.61.1

Command: wrangler whoami --config ./wrangler.jsonc

 â›…ï¸ wrangler 4.61.1
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Getting User settings...
ğŸ‘‹ You are logged in with an OAuth Token, associated with the email anchorskov@gmail.com.
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Account Name                   â”‚ Account ID                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Anchorskov@gmail.com's Account â”‚ 8bfd3f60fbdcc89183e9e312fb03e86e â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ”“ Token Permissions:
Scope (Access)
- account (read)
- user (read)
- workers (write)
- workers_kv (write)
- workers_routes (write)
- workers_scripts (write)
- workers_tail (read)
- d1 (write)
- pages (write)
- zone (read)
- ssl_certs (write)
- ai (write)
- queues (write)
- pipelines (write)
- secrets_store (write)
- containers (write)
- cloudchamber (write)
- connectivity (admin)
- offline_access 

===============================================================================
B) TAIL READINESS & DEPLOYMENTS
===============================================================================

Attempting: wrangler deployments list --config ./wrangler.jsonc grassmvtsurvey-production

[31mâœ˜ [41;31m[[41;97mERROR[41;31m][0m [1mUnknown argument: grassmvtsurvey-production[0m


wrangler deployments list

Displays the 10 most recent deployments of your Worker

GLOBAL FLAGS
  -c, --config    Path to Wrangler configuration file  [string]
      --cwd       Run as if Wrangler was started in the specified directory instead of the current working directory  [string]
  -e, --env       Environment to use for operations, and for selecting .env and .dev.vars files  [string]
      --env-file  Path to an .env file to load - can be specified multiple times - values from earlier files are overridden by values in later files  [array]
  -h, --help      Show help  [boolean]
  -v, --version   Show version number  [boolean]

OPTIONS
      --name  Name of the Worker  [string]
      --json  Display output as clean JSON  [boolean] [default: false]
ğŸªµ  Logs were written to "/home/anchor/.wrangler/logs/wrangler-2026-01-30_19-51-50_285.log"
âœ— Variant 1 failed, trying variant 2...

Attempting: wrangler deployments list --config ./wrangler.jsonc --env production grassmvtsurvey

[31mâœ˜ [41;31m[[41;97mERROR[41;31m][0m [1mUnknown argument: grassmvtsurvey[0m


wrangler deployments list

Displays the 10 most recent deployments of your Worker

GLOBAL FLAGS
  -c, --config    Path to Wrangler configuration file  [string]
      --cwd       Run as if Wrangler was started in the specified directory instead of the current working directory  [string]
  -e, --env       Environment to use for operations, and for selecting .env and .dev.vars files  [string]
      --env-file  Path to an .env file to load - can be specified multiple times - values from earlier files are overridden by values in later files  [array]
  -h, --help      Show help  [boolean]
  -v, --version   Show version number  [boolean]

OPTIONS
      --name  Name of the Worker  [string]
      --json  Display output as clean JSON  [boolean] [default: false]
ğŸªµ  Logs were written to "/home/anchor/.wrangler/logs/wrangler-2026-01-30_19-51-51_102.log"
âœ— Both variants failed

===============================================================================
C) PRODUCTION AUTH ENDPOINT HEALTH
===============================================================================

Command: curl -sS -D - https://grassrootsmvt.org/api/auth/me -o /tmp/auth_me_body.txt

Response Headers:
{"authenticated":false}
HTTP Status: 200

Response Body (first 100 lines):
{"authenticated":false}
===============================================================================
D) D1 SCHEMA VERIFICATION
===============================================================================

Command: wrangler d1 execute wy --config ./wrangler.jsonc --env production --command "PRAGMA table_info(session);"

 â›…ï¸ wrangler 4.61.1
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Resource location: local 

Use --remote if you want to access the remote instance.

ğŸŒ€ Executing on local database wy (4b4227f1-bf30-4fcf-8a08-6967b536a5ab) from .wrangler/state/v3/d1:
ğŸŒ€ To execute on your remote database, add a --remote flag to your wrangler command.
ğŸš£ 1 command executed successfully.
[
  {
    "results": [
      {
        "cid": 0,
        "name": "id",
        "type": "TEXT",
        "notnull": 1,
        "dflt_value": "null",
        "pk": 1
      },
      {
        "cid": 1,
        "name": "expires_at",
        "type": "INTEGER",
        "notnull": 1,
        "dflt_value": "null",
        "pk": 0
      },
      {
        "cid": 2,
        "name": "user_id",
        "type": "TEXT",
        "notnull": 1,
        "dflt_value": "null",
        "pk": 0
      },
      {
        "cid": 3,
        "name": "created_at",
        "type": "TEXT",
        "notnull": 1,
        "dflt_value": "CURRENT_TIMESTAMP",
        "pk": 0
      },
      {
        "cid": 4,
        "name": "last_seen_at",
        "type": "TEXT",
        "notnull": 1,
        "dflt_value": "CURRENT_TIMESTAMP",
        "pk": 0
      }
    ],
    "success": true,
    "meta": {
      "duration": 1
    }
  }
]

Command: wrangler d1 execute wy --config ./wrangler.jsonc --env production --command "PRAGMA table_info(user);"

 â›…ï¸ wrangler 4.61.1
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Resource location: local 

Use --remote if you want to access the remote instance.

ğŸŒ€ Executing on local database wy (4b4227f1-bf30-4fcf-8a08-6967b536a5ab) from .wrangler/state/v3/d1:
ğŸŒ€ To execute on your remote database, add a --remote flag to your wrangler command.
ğŸš£ 1 command executed successfully.
[
  {
    "results": [
      {
        "cid": 0,
        "name": "id",
        "type": "TEXT",
        "notnull": 1,
        "dflt_value": "null",
        "pk": 1
      },
      {
        "cid": 1,
        "name": "email",
        "type": "TEXT",
        "notnull": 1,
        "dflt_value": "null",
        "pk": 0
      },
      {
        "cid": 2,
        "name": "password_hash",
        "type": "TEXT",
        "notnull": 1,
        "dflt_value": "null",
        "pk": 0
      },
      {
        "cid": 3,
        "name": "created_at",
        "type": "TEXT",
        "notnull": 1,
        "dflt_value": "CURRENT_TIMESTAMP",
        "pk": 0
      }
    ],
    "success": true,
    "meta": {
      "duration": 1
    }
  }
]

Command: SELECT name, sql FROM sqlite_master WHERE type='table' AND name IN ('session','user');

 â›…ï¸ wrangler 4.61.1
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Resource location: local 

Use --remote if you want to access the remote instance.

ğŸŒ€ Executing on local database wy (4b4227f1-bf30-4fcf-8a08-6967b536a5ab) from .wrangler/state/v3/d1:
ğŸŒ€ To execute on your remote database, add a --remote flag to your wrangler command.
ğŸš£ 1 command executed successfully.
[
  {
    "results": [
      {
        "name": "user",
        "sql": "CREATE TABLE user (\n  id TEXT NOT NULL PRIMARY KEY,\n  email TEXT NOT NULL UNIQUE,\n  password_hash TEXT NOT NULL,\n  created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP\n)"
      },
      {
        "name": "session",
        "sql": "CREATE TABLE session (\n  id TEXT NOT NULL PRIMARY KEY,\n  expires_at INTEGER NOT NULL,\n  user_id TEXT NOT NULL, created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP, last_seen_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (user_id) REFERENCES user(id)\n)"
      }
    ],
    "success": true,
    "meta": {
      "duration": 1
    }
  }
]

===============================================================================
E) MIGRATION STATE
===============================================================================

Command: wrangler d1 migrations list wy --config ./wrangler.jsonc --env production

 â›…ï¸ wrangler 4.61.1
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Resource location: local 

Use --remote if you want to access the remote instance.

Migrations to be applied:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Name                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0012_oauth_tables.sql â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Local migrations directory:
  Found: db/migrations
total 64
drwxr-xr-x 2 anchor anchor 4096 Jan 30 10:13 .
drwxr-xr-x 3 anchor anchor 4096 Jan 21 07:55 ..
-rw-r--r-- 1 anchor anchor 4243 Jan 21 08:06 0001_survey_tables.sql
-rw-r--r-- 1 anchor anchor 4897 Jan 21 08:26 0002_seed_more_surveys.sql
-rw-r--r-- 1 anchor anchor 1500 Jan 21 09:11 0003_scope_scaffold.sql
-rw-r--r-- 1 anchor anchor 1230 Jan 21 16:57 0004_survey_tokens.sql
-rw-r--r-- 1 anchor anchor 3420 Jan 27 09:19 0005_survey_versions.sql
-rw-r--r-- 1 anchor anchor 1893 Jan 27 12:50 0006_auth_tables.sql
-rw-r--r-- 1 anchor anchor  618 Jan 28 08:37 0007_password_reset_tokens.sql
-rw-r--r-- 1 anchor anchor 1089 Jan 28 09:10 0008_passkey_tables.sql
-rw-r--r-- 1 anchor anchor  735 Jan 28 12:51 0009_response_editing.sql
-rw-r--r-- 1 anchor anchor  241 Jan 29 07:35 0010_user_email_normalized_unique.sql
-rw-r--r-- 1 anchor anchor  535 Jan 29 08:11 0011_session_timeouts.sql
-rw-r--r-- 1 anchor anchor  640 Jan 29 17:33 0012_oauth_tables.sql

  Not found: migrations

===============================================================================
END OF DIAGNOSTICS
===============================================================================
Generated: 2026-01-30 19:51:55 UTC
